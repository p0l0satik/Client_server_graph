# Client_server_graph

Это консольное клиент серверное приложение для вычисление кратчайшего маршрута в заданном графе.

Приложение состоит из двух частей обернутых в docker контейнеры:
- `p0l0satik/server_app`
- `p0l0satik/client_app`

Каждый черверный контейнер может единовременно корректно обработать один клиентский контейнер.
Для обработки множества клиентов используется docker swarm

### Возможности:
- вычисление длинны кратчайшего пути
- вывод кратчайшего пути
- добавление ребра
- изменение ребра
- добавление узла
- вывод графа на экран
- ввод графа через консоль и из файла

## Как развернуть сервис на площадке play with docker:
1. Регистрация:
    - зарегистрируйтесь на сервисе Docker Hub: [DockerHub](https://hub.docker.com), вы создадите новый Docker ID
    - Перейдите по ссылке [Play with docker](https://labs.play-with-docker.com)
    - Авторизируйтесь с помощью только что полученного Docker ID
    - Вы создадите сессию, длинной в 4 часa

2. Добавление хостов:
    - Вы можете создавать хосты с помощью кнопки "+ ADD NEW INSTANCE".
    - Слева отражен список всех хостов и их адреса, вы можете переключаться между хостами.
    - Вам потребуется два хоста: клиент и сервер

3. Развертывание сервера:  
    - Добавьте новый хост и введите в терминал следующую команду:  `docker run -p 49150:49150 p0l0satik/server_app`
    эта команда скачает из репозитория образ сервера и запустит его в контейнере docker
    - `-p` связывает порты контейнера и хоста, в данном случае это порт `49150`, важно чтобы сервер находился именно на этом порте

4. Развертывание клиента:
    - Добавьте новый хост и введите в терминал следующую команду: `docker run -it -p 8080:8080 p0l0satik/client_app` 
    эта команда скачает из репозитория образ клиента и запустит его в контейнере docker
    - `-it` позволит вам взаимодействовать с клиентом
    - порт клиента нам не важен, но необходимо опубликовать хотя бы один порт клиентского контейнера
    - когда клиент запустится, он попросит вас ввести IP адресс сервера, введите адрес того хоста на котором запущен 
    контейнер сервера
    
## Как работать с приложением:
1. Развертывание:
    - Разверните приложение на площадке play with docker 
2. Ввод графа:
    - Как только вы введете IP адрес сервера, и установится соединение выберете удобный вам сособ ввода графа
    - введите `1` для ввода графа с консоли 
    - введите `2` для ввода через файл
3. Ввод с консоли
    - Введите число узлов (к примеру `2`)
    - Затем перечислите сами узлы, каждое число будет обозначать номер узла (например `4 10`)
    - После этого введите число ребер (например `1`)
    - И наконец введите само ребро - три цифры через пробел: номер узла откуда исходит ребро, номер узла куда ведет ребро и вес ребра
    к примеру коменда `4 10 15` задает ребро из узла 4 в узел 10 с весом 15
    **Внимание: ребра ориентированные!**
4. Ввод через файл
    - Формат файлового ввода идентичен консольному. К примеру через файл вы могли бы задать граф, показанный выше, так:
    ```
    2
    4 10
    1
    4 10 15
    ```
5. Вычисление пути
    Следующее меню прдложит вам несколько команд на выбор, чтобы вычислить путь:
    - введите `1` чтобы узнать длинну кратчайшего мершрута между двумя вершинами
    - введите `2` если вы хотите также увидеть сам маршрут
    - введите два номера узлов в графе: откуда прокладывать маршрут и куда
    - К примеру, для графа выше запрос пути (1 - без маршрута) `4 10` выдаст ответ  15
6. Добавление пути
    Вы можете добавить узел в граф следующим образом
    - В меню введите цифру `3`
    - Введите число - номер желаемого узла (например 1)
    - Если добавление успешно вы вернетесь в меню
    - Если возникла ошибка(например такой узел уже есть) приложение известит вас об это и предложит либо вернуться в меню либо попробовать снова(варианты `0` и `1` соответсвенно)
7. Добавление ребра
    Если вы хотите добавить новое ребро
    - В меню введите `4`
    - Ввведите ребро - три цифры через пробел: номер узла откуда исходит ребро, номер узла куда ведет ребро и вес ребра
    **Узлы должны существовать, но между ними не должно быть ребра в указанно направлении**
    К примеру в графе выше можно добавить ребро из 10 в 3 весом 5 командой `10 3 5`
8. Изменение ребра
    Если вы хотите изменить существующее ребро
    - В меню введите `5`
    - Процесс указания ребра аналогичен добавлению нового, однако есть одна особенность: вы должны указать существующее ребро:
    Запрос `4 10 1` будет корректен, в то время как запросы `4 12 1` или `10 4 1` выдадут ошибку: в первом случае нет узла 12 во втором ребра из 10 в 4.
9. Вывод графа
    Вы можете вывезти граф в любой момент из меню. Для этого введите `6` 

## Как запустить многопользовательское приложение с использованием docker swarm:
1. Сессия
    - Создание сессию на площадке: [Play with docker](https://labs.play-with-docker.com)
2. Инициализация swarm
    - Создайте хост и запустите swarm командой:
    - docker `swarm init --advertise-addr %ip_of_your_host%`
    - вместо `%ip_of_your_host%` вам нужно подставить IP вашего хоста
3. Добавление работников
    - есть два типа узлов - менеджер и работник. Предыдущей командой вы создали менеджера который будет управлять swarm. 
    - менеджер выдал вам строку вида:
    `docker swarm join --token SWMTKN-1-0j7pjebjsrhj9fbndqp2c78ql1klstpp3hfpmua02egzcn3w9i-796r0dh0gn0llnhfeux94etdr   192.168.0.17:2377`
    это команда добавления узла-работника к swarm
    - создайте хост и скопируйте ее(ту команду которую менеджер выдал ВАМ) в терминал этого хоста
4. Запуск сервиса
    - командой `docker service create --name=server --publish published=49150,target=49150 --replicas=2 p0l0satik/server_app`
    вы создадите и запустите две копии контейнера `p0l0satik/server_app`
    - swarm автоматически старается распределить контейнеры так чтобы на каждом хосте была только одна копия
    - как менеджеры так и рабочие могут запускать контейнеры, в данном случае один контейнер будет запущен на рабочем, второй на менеджере
5. Несколько клиентов
    - создайте еще два хоста и в каждом запустите клиентский контейнер командой:
    `docker run -it -p 8080:8080 p0l0satik/client_app`
    - в качестве IP адреса обоим подайте адресс менеджера(самый первый хост)
    - попробуйте вбить какие-нибудь графы и проверить работает ли приложение
6. Один хост - один клиент
    - Из-за статической привязки портов для каждого клиента требуется один хост(в данном примере, если попробовать подключить третьего клиента его работа будет некорректной!)
    - командой `docker service scale имя_сервиса=количество_копий` можно увеличить изначально запущенное число копий на заданное значение
    - однако если на одном хосте будет два или больше серверных контейнеров работать они будут как один из-за статической проброски портов
    
 
